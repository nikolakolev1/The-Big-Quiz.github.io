<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz League ‚Äî Monday Nights</title>
  <meta name="description" content="Public record of our Monday quiz results at The Big Quiz held @ The Academy. Seasons by year, quiz history, and leaderboards." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; /* deep space */
      --panel:#0f1530ee; /* glass */
      --text:#ebefff;
      --muted:#9bb0ffcc;
      --accent:#8b5cf6; /* violet */
      --accent-2:#22d3ee; /* cyan */
      --accent-3:#f43f5e; /* rose */
      --gold:#f5c542;
      --ok:#10b981;
      --bad:#ef4444;
      --shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
      --glass:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      --neon:0 0 12px rgba(139,92,246,.65), 0 0 32px rgba(34,211,238,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 600px at 10% 10%, #111a3a, transparent), radial-gradient(900px 600px at 90% 10%, #221144, transparent), radial-gradient(1000px 800px at 50% 100%, #0a1a2a, transparent), var(--bg);
      overflow-x:hidden;
    }
    /* Animated gradient veil */
    .veil{position:fixed; inset:-40vmax; background: conic-gradient(from 90deg at 50% 50%, rgba(34,211,238,.08), rgba(139,92,246,.12), rgba(244,63,94,.08), rgba(34,211,238,.12)); filter: blur(80px); animation: spin 60s linear infinite; opacity:.6; pointer-events:none;}
    @keyframes spin{to{transform: rotate(360deg)}}

    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px); background: linear-gradient(180deg, rgba(15,21,48,.9), rgba(15,21,48,.6));
      border-bottom: 1px solid rgba(255,255,255,.07);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 20px;}
    .brand{display:flex; align-items:center; gap:14px}
    .logo{width:42px; height:42px; border-radius:12px; background: radial-gradient(circle at 30% 30%, var(--accent-2), transparent 60%), radial-gradient(circle at 70% 70%, var(--accent), transparent 60%), linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,0)); box-shadow: var(--neon); position:relative}
    .logo:after{content:''; position:absolute; inset:3px; border-radius:9px; border:1px solid rgba(255,255,255,.25)}
    h1.title{font-family:Orbitron, Inter, sans-serif; letter-spacing:.6px; font-size: clamp(20px, 2.7vw, 34px); margin:0}
    .subtitle{color:var(--muted); font-size:14px}

    /* Panels */
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:22px; margin:20px auto;}
    @media (max-width: 900px){.grid{grid-template-columns: 1fr;}}
    .panel{background: var(--panel); background-image: var(--glass); border:1px solid rgba(255,255,255,.06); border-radius:18px; box-shadow: var(--shadow); overflow:hidden}
    .panel .head{display:flex; align-items:center; justify-content:space-between; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.06)}
    .panel .head h2{margin:0; font-size:18px}
    .panel .body{padding:18px}

    /* Buttons */
    .btn{appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:600; color:#07111f; background:linear-gradient(180deg, #fff, #cfe8ff); box-shadow:0 8px 24px rgba(34,211,238,.25); cursor:pointer}
    .btn:hover{filter:brightness(1.05)}
    .btn.secondary{color:var(--text); background: linear-gradient(180deg, #1a244a, #141a36); border:1px solid rgba(255,255,255,.1)}
    .btn.ghost{background: transparent; color:var(--muted); border:1px dashed rgba(255,255,255,.2)}
    .btn.danger{background: linear-gradient(180deg, #fdd, #fca5a5); color:#3b0d0d}

    /* Controls row */
    .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    select, input[type="date"], input[type="number"], input[type="text"], textarea{
      background:#0c1330; color:var(--text); border-radius:10px; border:1px solid rgba(255,255,255,.15); padding:10px 12px; outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    select{cursor:pointer}

    /* Leaderboard */
    table{width:100%; border-collapse:collapse;}
    thead th{font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); text-align:left; border-bottom:1px solid rgba(255,255,255,.1); padding:8px 8px}
    tbody td{padding:10px 8px; border-bottom:1px dashed rgba(255,255,255,.07)}
    tbody tr:hover{background: rgba(255,255,255,.03)}

    .rank{width:42px; text-align:center; font-weight:800}
    .medal{filter: drop-shadow(0 0 10px rgba(245,197,66,.6))}

    /* Quiz history */
    .quiz-card{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding:14px; margin:12px 0; border:1px solid rgba(255,255,255,.07); border-radius:14px; background: rgba(10,20,40,.6)}
    .quiz-title{font-weight:700}
    .quiz-meta{color:var(--muted)}
    details summary{cursor:pointer; list-style:none}
    details summary::-webkit-details-marker{display:none}

    /* Footer */
    footer{opacity:.8; color:var(--muted); font-size:13px; text-align:center; padding:20px 10px}

    /* Toast */
    .toast{position:fixed; right:16px; bottom:16px; padding:12px 14px; border-radius:12px; background:#07111f; color:var(--text); border:1px solid rgba(255,255,255,.1); box-shadow: var(--shadow); opacity:0; transform: translateY(12px); transition: all .25s ease; z-index:50}
    .toast.show{opacity:1; transform:translateY(0)}

    /* Modal */
    .modal{position:fixed; inset:0; background:rgba(5,8,16,.65); backdrop-filter: blur(8px); display:none; align-items:center; justify-content:center; padding:20px; z-index:40}
    .modal.open{display:flex}
    .modal-card{width:min(860px, 96vw); background:var(--panel); background-image: var(--glass); border:1px solid rgba(255,255,255,.07); border-radius:18px; box-shadow: var(--shadow)}
    .modal-card .head{display:flex; align-items:center; justify-content:space-between; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.06)}
    .modal-card .body{padding:18px}
    .two-col{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
    @media (max-width: 800px){.two-col{grid-template-columns: 1fr}}

    /* Neon glow headline */
    .glow{color:#fff; text-shadow:0 0 8px rgba(139,92,246,.8), 0 0 22px rgba(34,211,238,.6)}

    /* Confetti canvas */
    #fx{position:fixed; inset:0; pointer-events:none; z-index:60}
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="veil" aria-hidden="true"></div>
  <header>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:16px">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 class="title glow">Monday Quiz League</h1>
          <div class="subtitle">Public scoreboard for our Monday weekly quiz results at The Big Quiz held @ The Academy.</div>
        </div>
      </div>
      <div class="controls">
        <label>
          <span class="subtitle" style="display:block; font-size:11px; text-transform:uppercase; letter-spacing:.08em">Season</span>
          <select id="seasonSelect"></select>
        </label>
        <button class="btn secondary" id="btnNewSeason" title="Start next season (new year)">New Season</button>
        <button class="btn" id="btnAddQuiz" title="Add a new Monday quiz result">+ Add Quiz</button>
        <button class="btn ghost" id="btnExport" title="Export JSON backup">Export</button>
        <label class="btn ghost" style="cursor:pointer" title="Import JSON backup">
          Import <input type="file" id="fileImport" accept="application/json" hidden>
        </label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <!-- Leaderboard panel -->
      <div class="panel" id="leaderboardPanel">
        <div class="head">
          <h2>Leaderboard</h2>
          <div class="controls">
            <select id="metricSelect">
              <option value="total">Total Points</option>
              <option value="average">Average</option>
              <option value="best">Best Quiz</option>
            </select>
          </div>
        </div>
        <div class="body">
          <table id="leaderboard">
            <thead>
              <tr><th class="rank">#</th><th>Player</th><th>Quizzes</th><th>Total</th><th>Average</th><th>Best</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Season stats / next quiz -->
      <div class="panel">
        <div class="head">
          <h2>Season Snapshot</h2>
          <div class="subtitle" id="seasonLabel"></div>
        </div>
        <div class="body" id="seasonStats"></div>
      </div>
    </section>

    <!-- Quiz History -->
    <section class="panel">
      <div class="head">
        <h2>Quiz History</h2>
        <div class="subtitle">Click any quiz to view detailed scores</div>
      </div>
      <div class="body" id="quizHistory"></div>
    </section>
  </main>

  <footer>
    Made with üíú on GitHub Pages. Data is stored in your browser (localStorage). Use Export/Import to back it up or share.
  </footer>

  <!-- Add Quiz Modal -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <div class="head">
        <h3 style="margin:0">Add Monday Quiz</h3>
        <button class="btn secondary" id="btnCloseModal">Close</button>
      </div>
      <div class="body">
        <div class="two-col">
          <div>
            <label>Date (Monday)
              <input type="date" id="quizDate" required style="width:100%; margin-top:6px">
            </label>
          </div>
          <div>
            <label>Location / Notes
              <input type="text" id="quizNotes" placeholder="Pub name, special theme, etc." style="width:100%; margin-top:6px">
            </label>
          </div>
        </div>

        <div style="margin-top:16px">
          <div class="controls" style="justify-content:space-between">
            <h4 style="margin:0">Players & Scores</h4>
            <div>
              <button class="btn ghost" id="btnAddPlayer">+ Add Player</button>
            </div>
          </div>
          <div id="playersList" style="margin-top:10px; display:grid; grid-template-columns: 1.4fr .8fr auto; gap:10px"></div>
        </div>

        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:18px">
          <button class="btn danger" id="btnClearForm" title="Clear the form">Clear</button>
          <button class="btn" id="btnSaveQuiz">Save Quiz</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Saved!</div>

  <script>
    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmt = n => new Intl.NumberFormat().format(n);

    const STORAGE_KEY = 'quizLeagueData:v1';

    const demoData = {
      seasons: {
        '2025': {
          players: ['Gorsko Slivovo'],
          quizzes: [
            { date:'2025-09-30', notes:'General Knowledge', scores:{ 'Gorsko Slivov': 2 } },
            { date:'2025-10-06', notes:'General Knowledge', scores:{ 'Gorsko Slivov': 4 } }
          ]
        }
      },
      currentSeason: '2025'
    };

    function load(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || demoData }catch(e){ return demoData }
    }
    function save(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

    // ---------- Rendering ----------
    let state = load();

    const seasonSelect = $('#seasonSelect');
    const metricSelect = $('#metricSelect');

    function renderSeasons(){
      const years = Object.keys(state.seasons).sort((a,b)=>b.localeCompare(a));
      seasonSelect.innerHTML = years.map(y=>`<option value="${y}" ${y===state.currentSeason?'selected':''}>${y}</option>`).join('');
      $('#seasonLabel').textContent = `Season ${state.currentSeason} ¬∑ ${state.seasons[state.currentSeason].quizzes.length} quizzes`;
    }

    function getSeason(){ return state.seasons[state.currentSeason]; }

    function computeLeaderboard(){
      const s = getSeason();
      const stats = {};
      s.players.forEach(p=> stats[p] = { quizzes:0, total:0, best:0 });
      s.quizzes.forEach(q=>{
        Object.entries(q.scores).forEach(([p,score])=>{
          if(!(p in stats)) stats[p] = { quizzes:0, total:0, best:0 };
          stats[p].quizzes++; stats[p].total += Number(score)||0; stats[p].best = Math.max(stats[p].best, Number(score)||0);
        })
      })
      const rows = Object.entries(stats).map(([p,st])=> ({
        player:p,
        quizzes: st.quizzes,
        total: st.total,
        average: st.quizzes? st.total / st.quizzes : 0,
        best: st.best
      }));
      return rows;
    }

    function renderLeaderboard(){
      const tbody = $('#leaderboard tbody');
      const metric = metricSelect.value;
      const rows = computeLeaderboard().sort((a,b)=>{
        if(metric==='total') return b.total - a.total;
        if(metric==='average') return b.average - a.average;
        if(metric==='best') return b.best - a.best;
        return 0;
      });
      tbody.innerHTML = rows.map((r,i)=>{
        const medal = i===0? 'ü•á' : i===1? 'ü•à' : i===2? 'ü•â' : '';
        return `<tr>
          <td class="rank">${i+1} ${medal?`<span class="medal" title="Top ${i+1}">${medal}</span>`:''}</td>
          <td style="font-weight:700">${r.player}</td>
          <td>${r.quizzes}</td>
          <td>${fmt(r.total)}</td>
          <td>${r.average? r.average.toFixed(2): '0.00'}</td>
          <td>${fmt(r.best)}</td>
        </tr>`
      }).join('');
    }

    function renderHistory(){
      const box = $('#quizHistory');
      const s = getSeason();
      const quizzes = [...s.quizzes].sort((a,b)=> a.date.localeCompare(b.date)).reverse();
      if(!quizzes.length){ box.innerHTML = '<p class="subtitle">No quizzes yet ‚Äî click ‚ÄúAdd Quiz‚Äù.</p>'; return; }
      box.innerHTML = quizzes.map(q=>{
        const top = Object.entries(q.scores).sort((a,b)=> b[1]-a[1])[0];
        const topLine = top? `${top[0]} ‚Ä¢ ${top[1]} pts` : '‚Äî';
        const scoresTable = `<table><thead><tr><th>Player</th><th>Score</th></tr></thead><tbody>`+
          Object.entries(q.scores).sort((a,b)=> b[1]-a[1]).map(([p,sc])=>`<tr><td>${p}</td><td>${fmt(sc)}</td></tr>`).join('')+
          `</tbody></table>`;
        return `<details class="quiz-card">
          <summary>
            <div>
              <div class="quiz-title">${new Date(q.date+'T00:00:00').toLocaleDateString(undefined,{weekday:'long', year:'numeric', month:'short', day:'numeric'})}</div>
              <div class="quiz-meta">${q.notes ? q.notes+' ¬∑ ' : ''}Top: <strong>${topLine}</strong></div>
            </div>
            <div><span class="btn ghost" data-edit="${q.date}">Edit</span></div>
          </summary>
          <div style="grid-column:1/-1; margin-top:10px">${scoresTable}</div>
        </details>`
      }).join('');

      // Wire up inline edit buttons
      $$('span[data-edit]').forEach(el=> el.addEventListener('click', () => openEdit(el.dataset.edit)));
    }

    function renderSeasonStats(){
      const s = getSeason();
      const totalQuizzes = s.quizzes.length;
      const latest = s.quizzes.map(q=>q.date).sort().pop();
      const nextMonday = computeNextMonday();
      const bestQuiz = (()=>{
        const flat = [];
        s.quizzes.forEach(q=>Object.entries(q.scores).forEach(([p,sc])=> flat.push({p,sc, date:q.date })));
        return flat.sort((a,b)=> b.sc - a.sc)[0];
      })();

      $('#seasonStats').innerHTML = `
        <div class="two-col">
          <div class="panel" style="padding:0">
            <div class="head"><h3 style="margin:0">Season Progress</h3></div>
            <div class="body">
              <div class="subtitle">Quizzes so far</div>
              <div class="glow" style="font-size:42px; font-weight:800">${fmt(totalQuizzes)}</div>
              <div class="subtitle" style="margin-top:8px">Latest quiz: ${latest ? new Date(latest+'T00:00:00').toLocaleDateString() : '‚Äî'}</div>
            </div>
          </div>
          <div class="panel" style="padding:0">
            <div class="head"><h3 style="margin:0">Next Monday</h3></div>
            <div class="body">
              <div class="glow" style="font-size:32px; font-weight:800">${nextMonday.toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric'})}</div>
              <div class="subtitle">Ready for the next battle ‚ú®</div>
            </div>
          </div>
        </div>
        <div class="panel" style="margin-top:16px">
          <div class="head"><h3 style="margin:0">Best Single Quiz</h3></div>
          <div class="body">
            ${bestQuiz ? `<div style="font-size:18px"><strong>${bestQuiz.p}</strong> scored <strong>${fmt(bestQuiz.sc)}</strong> on ${new Date(bestQuiz.date+'T00:00:00').toLocaleDateString()}</div>` : '<div class="subtitle">‚Äî</div>'}
          </div>
        </div>`;
    }

    // ---------- Modals & Forms ----------
    const modal = $('#modal');
    const playersList = $('#playersList');

    function openModal(){ modal.classList.add('open'); buildPlayersInputs(); prefillDate(); }
    function closeModal(){ modal.classList.remove('open'); }

    function prefillDate(){
      // Default to last Monday or today if Monday
      const d = new Date();
      const day = d.getDay(); // 1 = Mon (in JS 1=Mon if we map, but actually 1=Mon? No: JS 1=Mon? JS: 0=Sun, 1=Mon)
      const monday = new Date(d);
      const diff = (day===1)?0: ((day+6)%7); // days since Monday
      monday.setDate(d.getDate()-diff);
      $('#quizDate').value = monday.toISOString().slice(0,10);
    }

    function computeNextMonday(){
      const d = new Date();
      const day = d.getDay(); // 0=Sun .. 6=Sat
      const add = (8 - day) % 7; // days to next Monday
      const next = new Date(d); next.setDate(d.getDate() + (add||7));
      next.setHours(12,0,0,0);
      return next;
    }

    function buildPlayersInputs(existingScores){
      const s = getSeason();
      const players = [...new Set([...(s.players||[]), ...(existingScores? Object.keys(existingScores): [])])];
      playersList.innerHTML = '';
      players.forEach(p=> addPlayerRow(p, existingScores? existingScores[p] : ''));
    }

    function addPlayerRow(name='', score=''){
      const row = document.createElement('div');
      row.className = 'player-row';
      row.innerHTML = `
        <input type="text" class="pname" placeholder="Player name" value="${name}">
        <input type="number" class="pscore" placeholder="Score" inputmode="numeric" value="${score}" min="0" step="1">
        <button class="btn ghost">Remove</button>`;
      row.querySelector('button').addEventListener('click', ()=> row.remove());
      playersList.appendChild(row);
    }

    function collectScores(){
      const names = $$('.pname').map(i=>i.value.trim()).filter(Boolean);
      const dup = names.find((n,idx)=> names.indexOf(n) !== idx);
      if(dup){ toast(`Duplicate player: ${dup}`); return null }
      const scores = {};
      $$('.player-row').forEach(row=>{
        const n = row.querySelector('.pname').value.trim();
        const v = Number(row.querySelector('.pscore').value || 0);
        if(n) scores[n] = v;
      })
      return scores;
    }

    function openEdit(date){
      const s = getSeason();
      const q = s.quizzes.find(x=>x.date===date);
      if(!q){ toast('Quiz not found'); return; }
      openModal();
      $('#quizDate').value = q.date;
      $('#quizNotes').value = q.notes||'';
      buildPlayersInputs(q.scores);
    }

    // ---------- Events ----------
    $('#btnAddQuiz').addEventListener('click', openModal);
    $('#btnCloseModal').addEventListener('click', closeModal);
    $('#btnAddPlayer').addEventListener('click', ()=> addPlayerRow());
    $('#btnClearForm').addEventListener('click', ()=>{ $('#quizDate').value=''; $('#quizNotes').value=''; playersList.innerHTML=''; });

    $('#btnSaveQuiz').addEventListener('click', ()=>{
      const date = $('#quizDate').value;
      if(!date){ toast('Pick a date'); return }
      const scores = collectScores(); if(!scores) return;
      const notes = $('#quizNotes').value.trim();
      const s = getSeason();
      // Upsert players list
      const newPlayers = Array.from(new Set([...(s.players||[]), ...Object.keys(scores)])).sort();
      s.players = newPlayers;
      // Upsert quiz by date
      const existing = s.quizzes.find(q=>q.date===date);
      if(existing){ existing.scores = scores; existing.notes = notes; }
      else { s.quizzes.push({ date, notes, scores }); }
      save(state); renderAll(); closeModal(); confetti(); toast('Quiz saved');
    });

    seasonSelect.addEventListener('change', ()=>{ state.currentSeason = seasonSelect.value; save(state); renderAll(); });
    metricSelect.addEventListener('change', renderLeaderboard);

    $('#btnNewSeason').addEventListener('click', ()=>{
      const nextYear = String((Number(Object.keys(state.seasons).sort().pop())||new Date().getFullYear()) + 1);
      const year = prompt('Create season (year):', nextYear);
      if(!year) return;
      if(state.seasons[year]){ toast('Season already exists'); return; }
      state.seasons[year] = { players: [], quizzes: [] };
      state.currentSeason = year;
      save(state); renderAll(); confetti(); toast(`Season ${year} created`);
    });

    $('#btnExport').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'quiz-league.json'; a.click(); URL.revokeObjectURL(url);
    });

    $('#fileImport').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          if(!data.seasons || !data.currentSeason) throw new Error('Invalid file');
          state = data; save(state); renderAll(); confetti(); toast('Import successful');
        }catch(err){ toast('Import failed: '+err.message) }
      };
      reader.readAsText(file);
    });

    // ---------- Toast & Confetti ----------
    function toast(msg){ const t = $('#toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), 2200) }

    // Minimal confetti effect
    const fx = document.getElementById('fx');
    const ctx = fx.getContext('2d');
    let particles = [];
    function resize(){ fx.width = innerWidth; fx.height = innerHeight }
    addEventListener('resize', resize); resize();
    function confetti(){
      for(let i=0;i<80;i++){
        particles.push({
          x: Math.random()*fx.width,
          y: -20,
          vx: (Math.random()-0.5)*2,
          vy: 2 + Math.random()*2.5,
          r: 2 + Math.random()*4,
          a: 1,
        })
      }
    }
    function tick(){
      ctx.clearRect(0,0,fx.width,fx.height);
      particles.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.a -= 0.008; p.vy += 0.02;
        ctx.globalAlpha = Math.max(p.a,0);
        ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r);
        g.addColorStop(0, 'rgba(34,211,238,1)');
        g.addColorStop(1, 'rgba(139,92,246,0)');
        ctx.fillStyle = g; ctx.fill();
      });
      particles = particles.filter(p=> p.a>0 && p.y < fx.height+20);
      requestAnimationFrame(tick);
    }
    tick();

    // ---------- Boot ----------
    function renderAll(){ renderSeasons(); renderLeaderboard(); renderHistory(); renderSeasonStats(); }
    renderAll();
  </script>
</body>
</html>
